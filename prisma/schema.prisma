generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Role {
  id        String     @id @default(cuid())
  name      String     @unique // "RESIDENT", "ADMIN", "SUPERADMIN"
  residents Resident[]
  createdAt DateTime   @default(now())
}

model Announcement {
  id          String       @id @default(cuid())
  title       String
  date        DateTime     @default(now())
  category    String       // "maintenance", "event", "general", "urgent"
  priority    String       @default("normal") // "low", "normal", "high"
  summary     String
  body        String
  author      String
  link        String?
  linkText    String?
  published   Boolean      @default(true)
  eventConfig EventConfig?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Resident {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  phone        String
  block        Int      // 1, 2, 3, or 4
  flatNumber   String   // e.g., "101", "G2"
  residentType String   // "OWNER" or "TENANT"
  googleImage  String?
  roleId       String
  role         Role     @relation(fields: [roleId], references: [id])
  rsvps        Rsvp[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model EventConfig {
  id             String       @id @default(cuid())
  announcementId String       @unique
  announcement   Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  mealType       String       // "breakfast", "lunch", "dinner"
  rsvpDeadline   DateTime
  menuItems      MenuItem[]
  rsvps          Rsvp[]
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}

model MenuItem {
  id            String      @id @default(cuid())
  eventConfigId String
  eventConfig   EventConfig @relation(fields: [eventConfigId], references: [id], onDelete: Cascade)
  name          String
  pricePerPlate Float
  sortOrder     Int         @default(0)
  rsvpItems     RsvpItem[]
  createdAt     DateTime    @default(now())
}

model Rsvp {
  id            String      @id @default(cuid())
  eventConfigId String
  eventConfig   EventConfig @relation(fields: [eventConfigId], references: [id], onDelete: Cascade)
  residentId    String
  resident      Resident    @relation(fields: [residentId], references: [id], onDelete: Cascade)
  items         RsvpItem[]
  paid          Boolean     @default(false)
  notes         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@unique([eventConfigId, residentId])
}

model RsvpItem {
  id         String   @id @default(cuid())
  rsvpId     String
  rsvp       Rsvp     @relation(fields: [rsvpId], references: [id], onDelete: Cascade)
  menuItemId String
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  plates     Int
  createdAt  DateTime @default(now())

  @@unique([rsvpId, menuItemId])
}
